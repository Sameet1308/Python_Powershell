import boto3
import json

def assume_role(role_arn, session_name):
    sts_client = boto3.client('sts')
    response = sts_client.assume_role(
        RoleArn=role_arn,
        RoleSessionName=session_name
    )
    return response['Credentials']

def get_glue_client(credentials):
    return boto3.client(
        'glue',
        aws_access_key_id=credentials['AccessKeyId'],
        aws_secret_access_key=credentials['SecretAccessKey'],
        aws_session_token=credentials['SessionToken']
    )

def copy_table_to_central(local_glue_client, central_glue_client, local_database_name, central_database_name, table_name):
    table = local_glue_client.get_table(DatabaseName=local_database_name, Name=table_name)['Table']
    table_input = {
        'Name': table['Name'],
        'Description': table.get('Description', ''),
        'StorageDescriptor': table['StorageDescriptor'],
        'PartitionKeys': table.get('PartitionKeys', []),
        'TableType': table['TableType'],
        'Parameters': table.get('Parameters', {})
    }
    central_glue_client.create_table(DatabaseName=central_database_name, TableInput=table_input)

def handler(event, context):
    # Local and central database names
    local_database_name = 'your_local_database'  # Replace with your local database name
    central_database_name = 'your_central_database'  # Replace with your central database name
    
    # Assume role ARN for central account
    central_role_arn = 'arn:aws:iam::123456789012:role/CentralGlueRole'  # Replace with your central role ARN
    session_name = 'CrossAccountGlueAccessSession'
    
    # Local Glue client
    local_glue_client = boto3.client('glue')
    
    # Assume role to get credentials for central account
    credentials = assume_role(central_role_arn, session_name)
    
    # Central Glue client with assumed role credentials
    central_glue_client = get_glue_client(credentials)
    
    # List tables in the local database
    tables = local_glue_client.get_tables(DatabaseName=local_database_name)['TableList']
    
    # Copy each table to the central Glue catalog
    for table in tables:
        table_name = table['Name']
        copy_table_to_central(local_glue_client, central_glue_client, local_database_name, central_database_name, table_name)
    
    return {
        'statusCode': 200,
        'body': json.dumps('Tables copied successfully!')
    }
